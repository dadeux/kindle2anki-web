<!DOCTYPE html>


<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, width=device-width">

        <!-- http://getbootstrap.com/docs/5.3/ -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

        <!-- favicon -->
        <link href="/static/favicon.ico" rel="icon">
        <link rel="apple-touch-icon" sizes="180x180" href="/static/images/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon-16x16.png">
        <!-- <link rel="manifest" href="/static/site.webmanifest"> -->
        <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
        <!-- styles -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
        <!-- <link href="/static/css/styles.css" rel="stylesheet"> -->

        <title>Kindle2Anki: {% block title %}{% endblock %}</title>

    </head>

    <body>
        <nav class="bg-light border navbar navbar-expand-md navbar-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="/"><span><img src="/static/images/kindle2anki_75.png" alt="Kindle2Anki Image"></span>
                    <div style="display: inline-block;">
                        <h3 class="green mt-4">&nbsp;&nbsp;&nbsp;Kindle2Anki</h3>
                    </div>
                </a>
                        {% if not session['user_id'] %}
                        <h6 class="green ms-3 mt-3">(Create Anki card decks from your Kindle Vocabulary Builder)</h6>
                        {% endif %}
                <button aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#navbar" data-bs-toggle="collapse" type="button">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbar">
                    {% if session['user_id'] %}
                        <ul class="navbar-nav me-auto mt-2">
                        {% if session['vocabdb_uploaded'] %}
                            <li class="nav-item"><a class="nav-link" href="/upload">Replace vocab.db</a></li>
                        {% else %}
                            <li class="nav-item"><a class="nav-link" href="/upload">Upload vocab.db</a></li>
                        {% endif %}
                        {% if session['vocabdb_uploaded'] %}
                            <li class="nav-item"><a class="nav-link" href="/create">Create Deck</a></li>
                        {% endif %}
                            <!-- <li class="nav-item"><a class="nav-link" href="/create">Configure Deck</a></li> -->
                        {% if session['has_history'] %}
                            <li class="nav-item"><a class="nav-link" href="/history">Deck Creation History</a></li>
                        {% endif %}
                            <li class="nav-item"><a class="nav-link" href="/changepw" target="_self">Change Password</a></li>
                        </ul>
                        <ul class="navbar-nav ms-auto mt-2">
                            <li class="mt-1 nav-item">Logged in as <b>{{ session['username'] }}</b>&nbsp;({{ session['email'] }}) </li>
                            <li class="ms-3"><a href="/logout" class="btn btn-success btn-sm rounded mt-0 py-1 px-2 text-white">Log out</a></li>
                            <!-- <li class="ms-3 btn btn-sm btn-success rounded-pill"><a class="nav-link text-white" href="/logout">Log Out</a></li> -->
                        </ul>
                    {% else %}
                        <ul class="navbar-nav ms-auto mt-2">
                            <li class="nav-item"><a class="nav-link" href="/register">Register</a></li>
                            <li class="nav-item"><a class="nav-link" href="/login">Log In</a></li>
                        </ul>
                    {% endif %}
                </div>
            </div>
        </nav>

       
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <header class="container-fluid px-0">
                <div class="alert alert-light flash-bar" role="alert">
                <ul class="flashes-sm mb-0 p-0 list-unstyled">
                    {% for category, message in messages %}
                        {% set textcolor = {
                            'success':'text-success',
                            'error':'text-danger',
                            'warning':'text-warning',
                            'info':'text-info'
                        }.get(category, 'text-secondary') %}

                        <li class="{{ textcolor }}">
                            {{ message }}
                        </li>
                    {% endfor %}
                </ul>
                </div>
            </header>
            {% endif %}
        {% endwith %}
        <main class="container py-3 text-center">
            {% block main %}{% endblock %}
        </main>

        <footer class="mb-5">
            <form action="https://validator.w3.org/check" class="text-center" enctype="multipart/form-data" method="post" target="_blank">
                <input name="doctype" type="hidden" value="HTML5">
                <input name="fragment" type="hidden">
                <!-- https://validator.w3.org/ -->
                <!-- <input alt="Validate" src="/static/I_heart_validator.png" type="image">  -->
            </form>
            <!-- <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Adapted from https://stackoverflow.com/a/10162353
                    const html = '<!DOCTYPE ' +
                    document.doctype.name +
                    (document.doctype.publicId ? ' PUBLIC "' + document.doctype.publicId + '"' : '') +
                    (!document.doctype.publicId && document.doctype.systemId ? ' SYSTEM' : '') +
                    (document.doctype.systemId ? ' "' + document.doctype.systemId + '"' : '') +
                    '>\n' + document.documentElement.outerHTML;
                    document.querySelector('form[action="https://validator.w3.org/check"] > input[name="fragment"]').value = html;
                });
            </script> -->
            
        </footer>

    </body>
        <script>
            // languageFilter
            const languageFilter = document.getElementById("languageFilter");
            if (languageFilter) {
                languageFilter.addEventListener("change", function () {
                    const selectedLang = this.value.toLowerCase();
                    const rows = document.querySelectorAll("#deckTable tr, #bookTable tr");

                    rows.forEach(row => {
                        const rowLang = row.dataset.lang.toLowerCase();
                        row.style.display =
                            selectedLang === "all" || rowLang === selectedLang
                                ? ""
                                : "none";
                    });
                });
            }
            // card Selection
            const cardTypeSelection = document.getElementById("cardTypeSelection")
            const createDeckButton = document.getElementById("createDeck")
            if (cardTypeSelection && createDeckButton) {
                createDeck.addEventListener("click", function (){
                    if (!cardTypeSelection.checkValidity()) {
                        return;
                    }
                    alert("deck creation job will start on the server side as soon as you close this message window by pressing <ok>.\nWhile the job is running this window will not reload. Depending on the number of words to be looked up this can take several minutes.\nPlease be patient and do NOT reload this page!")
                });
            }
            // uploadForm 
            const uploadForm = document.getElementById("uploadForm")
            const uploadButton = document.getElementById("uploadButton")
            if (uploadForm && uploadButton) {
                uploadButton.addEventListener("click", function (){
                    if (!uploadForm.checkValidity()) {
                        return;
                    }
                    alert("upload of vocab.db will trigger background tasks (e.g. online retrieval of book covers) on the server side as soon as you close this message window by pressing <ok>.\nWhile these tasks are running this window will not reload. Depending on the number of cover images to be looked up this can take a while.\nPlease be patient and do NOT reload this page!")
                });
            }
        </script>
</html>
